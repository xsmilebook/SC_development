# S4th_changerate_SAcorr
This folder contains scripts designed for age-resolved developmental analyses and separate analyses within subdatasets partitioned based on the flip age. This step aims to comprehensively understand the spatial correlations between development and the S-A connectional axis throughout the developmental process. 

## S1st_SAcorr_alongAge_*.Rmd
This script facilitates age-resolved developmental effect analysis. Spearmanâ€™s correlations were computed between the rank of the S-A connectional axis and the developmental rate assessed by the first derivative at 1,000 specific age points sampled across age spans. Next, correlation coefficients between the S-A connectional axis rank and the posterior derivative/derivative at each age point were determined. The resulting distribution of posterior correlation coefficients was employed to ascertain the median and 95% credible interval of alignment at each age point.

## In-repo runnable scripts (ComBat-GAM inputs)
For cluster runs on the current repo layout (inputs under `outputs/results/combat_gam/`), Rscript entrypoints were added. They read posterior derivatives generated by `development_script/2nd_fitdevelopmentalmodel` and write all new results/figures under `SCDevelopment/outputs/`.

- `S1st_SAcorr_alongAge_HCPD.R` (default inputs: `outputs/results/2nd_fitdevelopmentalmodel/hcpd/combat_gam/CV75/*derivative*.rds`)
- `S1st_SAcorr_alongAge_ABCD.R` (default inputs: `outputs/results/2nd_fitdevelopmentalmodel/abcd/combat_gam/CV75/*derivative*.rds`)

Cluster submission (Singularity container):
- `sbatch sbatch/run_hcpd_changerate_sacorr_combatgam_CV75_container.sbatch`
- `sbatch sbatch/run_abcd_changerate_sacorr_combatgam_CV75_container.sbatch`

Both scripts generate alignment figures (`.tiff` + `.pdf`) and print key numeric results to the SLURM log (e.g., flip-age median/CI and rho extrema).

## S2nd_fitgammodels_SA12sumSCinvnode_ageseperate_HCPD (Rscript)
For a full HCP-D 4th-step run, the age-separated (flip-age) GAM analysis script is available as:
- `S2nd_fitgammodels_SA12sumSCinvnode_ageseperate_HCPD.R` (Rscript; reads flip age from `alignment_summary_flip_age.csv` by default)

The HCP-D sbatch `sbatch/run_hcpd_changerate_sacorr_combatgam_CV75_container.sbatch` runs:
1) derivative generation (if missing),
2) age-resolved alignment (S1),
3) age-separated GAM analysis (S2).


## S2nd_fitgammodels_SA12sumSCinvnode_ageseperate_HCPD.Rmd
At the age point where the alignment of developmental rates with the S-A connectional axis experiences a reversal, the HCP-D dataset is partitioned into two sub-datasets. Next, developmental effects were estimated for each connection within the two subdatasets. Following this, correlations between the age effect size, as measured by partial R-square, and the connectional axis rank were computed.
